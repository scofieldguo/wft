<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>$!{head_title}</title>
<link rel="stylesheet" type="text/css" href="${style_url}/style.css?t=11"/>
<link rel="stylesheet" type="text/css" href="${style_url}/wait_style.css?t=11"/>
<link rel="stylesheet" type="text/css" href="${style_url}/manage_style.css"/>
<script type="text/javascript" src="${js_url}/jquery-1.4.2.js"></script>
<script type="text/javascript">
	function showConfirmForm(id){
		document.getElementById(id).style.display='block';
		$("#popup").addClass("popup");
	}
	function changeInfo(){
		window.location.href="manage_userInfo.action";
	}
</script>
</head>
<body onload="manageleftNav('wifi-open');viewNavTab('manager')">
	<!-- 头部内容 -->
	#parse("/WEB-INF/velocity/common/header.html")
	<div class="main_body">
		#parse("/WEB-INF/velocity/common/managehead.html")
		<div class="producer_content">
		#parse("/WEB-INF/velocity/common/manageleftnav.html")
			<div class="content r">
				<div class="person_title" style="height: 40px">
					开卡
					<p>开卡时长若不能满足您的需求,您可以对开出的时长卡进行充值！充值可以将您的卡有效期重置30天</p> 
				</div>
				<div style="width: 100%;float: left">
					<div style="margin-top: 15px;">
						<span style="text-align: right;display:inline-block;width: 150px;vertical-align: top;margin-top: 10px; ">选择时长：</span>
						<span style="display:inline-block;width: 200px;">
							<ul>
								<li style="float: left;margin-right: 15px;"><input id="card_0h"  type="button" value="15分钟" style="background-color:#3772A6;cursor:pointer;width:50px;border:1px solid #3772A6;height:28px;line-height:25px;color:#fff" onclick="flag(this.id)"/></li>																										
								<li style="float: left;margin-right: 15px;"><input id="card_1h"  type="button" value="1小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
								<li style="float: left;margin-right: 15px;"><input id="card_2h" type="button" value="2小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
								<li style="float: left;margin-right: 15px;"><input id="card_5h" type="button" value="5小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
								<li style="float: left;margin-right: 15px;"><input id="card_10h" type="button" value="10小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
								<li style="float: left;margin-right: 15px;"><input id="card_20h" type="button" value="20小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
								<li style="float: left;margin-right: 15px;"><input id="card_50h" type="button" value="50小时" style="background-color:#fff;cursor:pointer;width:50px;border:1px solid #C0C0C0;height:28px;line-height:25px;" onclick="flag(this.id)"/></li>
							</ul>
							<input type="hidden" value="1" id="card_0h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_1h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_2h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_5h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_10h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_20h_hide" name="cardhide"/>
							<input type="hidden" value="" id="card_50h_hide" name="cardhide"/>
						</span>
					</div>	
					<div style="margin-top: 15px;">
						<span style="text-align: right;display:inline-block;width: 150px; ">数量：</span>
						<span  style="display:inline-block;" >
								<input id="number" type="text" value="" style="width: 30px;height: 20px;text-align: center;"/>
						</span>
					</div >
					<div style="margin-top: 15px;"> 
						<span style="text-align: right;display:inline-block;width: 150px; "></span>
						<span>
							<input class="change_bt" type="button" onclick="openConfirm();" value="确认"/>
						</span>
					</div>
				</div>
			</div>
		</div>
		<div id="popup" >
			<div id="confirm_window">
				<div style="height: 40px;line-height:40px;;text-align: center;font-size: 18px;background-color: rgb(59, 180, 191);position: absolute;width: 100%;left:0;top:0">
					确认开卡
				</div>
				<div>
					<div style="margin-top: 30px;overflow: hidden">
						<span style="display: inline-block;width: 100px;text-align: right;">时长卡时长：</span>
						<span style="display: inline-block;" id="time_confirm"></span>
					</div>
					<div style="margin-top: 10px;overflow: hidden">
						<span  style="display: inline-block;width: 100px;text-align: right;">数量：</span>
						<span style="display: inline-block;" id="number_confirm"></span>
					</div>
					<div style="text-align: center;">
						<input class="cancel" type="button" value="取消" onclick="cancel('confirm_window');"/>
						<input class="submit" type="button" value="确认" onclick="confrim()"/>
					</div>
				</div>
			</div>
			<div id="opencard_fail" class="alertWindow">
				<div style="height: 40px;line-height:40px;;text-align: center;font-size: 18px;background-color: rgb(59, 180, 191);position: absolute;width: 100%;left:0;top:0">
					开卡失败
				</div>
				<div style="text-align: center;margin: 40px;">
					<p style="font-size: 16px;">余额不足,开卡失败,请您充值！</p>
					<input class="submit" type="button" value="确认" onclick="cancel('opencard_fail')"/>
				</div>
			</div>
			<div id="opencard_succ" class="alertWindow">
				<div style="height: 40px;line-height:40px;;text-align: center;font-size: 18px;background-color: rgb(59, 180, 191);position: absolute;width: 100%;left:0;top:0">
					开卡成功
				</div>
				<div style="text-align: center;margin: 40px;">
					<p style="font-size: 16px;" >您的开卡成功个数<span id="succ"></span >&nbsp;失败个数<span id="fail"></span></p>
					<br />
					<input class="submit" type="button" value="导出" onclick="exportExcel()" id="export"/>
					<input class="submit" type="button" value="确认" onclick="cancel('opencard_succ')"/>
				</div>
				<input type="hidden" id="order"/> 
			</div>
			<div id="count_win" class="alertWindow" >
				<div style="height: 40px;line-height:40px;;text-align: center;font-size: 18px;background-color: rgb(59, 180, 191);position: absolute;width: 100%;left:0;top:0">
					开卡中……
				</div>
				<div id="count_per" style="position: absolute;top:70px;height: 20px;text-align: center;line-height: 20px;width: 100%;left: 0">0%</div>
				<div id="ordercount" style="width: 200px;height: 20px;background-color: #fff;margin: 0px auto;margin-top:50px; border: 1px solid black;">
	 				<div id="countInner" style="width: 0px;height: 20px;">
	 			</div>
	 		</div>
	</div>
		</div>
	</div>
	<div class="clear"></div>
	<!-- footer -->
	#parse("/WEB-INF/velocity/common/footer.html")
	<script type="text/javascript">
		 function flag(id){
	    	var flag = $("#"+id+"_hide").val();
	    	if(flag == 1){
	    		$("#"+id+"_hide").val("");
	    		$("#"+id).css({"border-color":"#c0c0c0","background":"#fff","color":"#000"});
	    	}else{
	    		$("#"+id+"_hide").val(1);
	   			$("#"+id).css({"border-color":"#3772A6","background":"#3772A6","color":"#fff"});
	   			$("#"+id).parent().siblings().children('input').css({"border-color":"#c0c0c0","background":"#fff","color":"#000"});
	   			$("#"+id+"_hide").siblings().val("");
	    	}
	    }
	    
	    function openConfirm(){
	   		if(checkEmpty("number")==false){
	 		 	alert("数量不能为空");
	 			return false;
	 	    }
	    	var number=$("#number").val();
	    	if(number<=0){
	    		alert("数量必须大于0");
	    		return false;
	    	}
	    	$("#number_confirm").html(number);
	    	$("input[name='cardhide']").each(function(){
	    		if($(this).val()==1){
	    			var hour= $(this).attr('id').split("_")[1].replace("h","小时");
	    			if(hour=='0小时'){
	    				hour='0.25小时';
	    			}
	    			$("#time_confirm").html(hour);
	    		}
	    	})
	    	showConfirmForm("confirm_window");
	    }
	    
	    function cancel(id){
	    	$("#"+id).hide();
	    	$("#popup").removeClass("popup");
	    }
	    
	    function confrim(){
	    	$("#countInner").width(0);
	    	$("#count_per").html("0%");
	    	var number=$("#number").val();
	    	var time;
	    	$("input[name='cardhide']").each(function(){
	    		if($(this).val()==1){
	    			time= $(this).attr('id').split("_")[1].replace("h","");
	    			if(time==0){
	    				time=0.25;	
	    			}
	    		}
	    	})
	    	jQuery.ajax({
	    		url:"wifi_batchOpenCard.action",
	    		data:{"number":number,"time":time},
	    		dataType:'json',
	    		cache:false,
	    		sync:true,
	    		success:function(json){
	    			$("#confirm_window").hide();
	    			if(json.flag=='0'){
	    				showConfirmForm("opencard_fail");
	    			}
	    			if(json.flag=='1'){
	    			  showConfirmForm('count_win');		
	    			  var width= $("#ordercount").width();
	    			  var order= json.order;
	    			  var count=0;
	    			  var time;
	    			  time=setInterval(function(){
			    			  jQuery.ajax({
			    			  	url:"wifi_getOrderCount.action",
			    			  	data:{"order":order},
			    			  	dataType:'json',
			    			  	cache:false,
			    			  	sync:true,
			    			  	success:function(json){
			    			  		var succ=json.succ;
			    			  		var fail=json.fail;
			    			  		count=succ+fail;
			    			  		var innerWidth=count*(width/number);
			    			  		var per=((count/number)*100).toFixed(2)+"%";
			    			  		$("#countInner").width(innerWidth).css("background","rgb(59, 180, 191)");
			    			  		$("#count_per").html(per);
			    			  		if(count==number){
			    			  			setTimeout(function(){$("#count_win").hide();},4000);
			    			  			clearInterval(time);
			    			  		    $("#succ").html(json.succ);
	    								$("#fail").html(json.fail);
	    								$("#order").val(order);
	    								showConfirmForm("opencard_succ");
			    			  		}
			    			  	}
			    			  })}
			    			,1000);
	    			}
	    		}
	    	})
	    }
	    
	    
	    
	    
	    function exportExcel(){
	    	var order=$("#order").val();
	    	location.href="wifi_exportOpenCard.action?order="+order;
	    }
	
	</script>
</body>
</html>